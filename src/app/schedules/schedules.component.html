<div class="schedules-container">
  <div class="schedules-header">
    <h1 class="display-4" i18n="schedules page title">üïê Train Schedules</h1>
    <p class="lead" i18n="schedules page description">Check all departure and arrival times to plan your trip in New Caledonia</p>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner">üöÑ</div>
    <p i18n="@@schedules.loading">Loading schedules...</p>
  </div>

  <!-- Onglets -->
  <div *ngIf="!loading" class="tabs-container">
    <div class="tabs-header">
      <button 
        class="tab-button"
        [class.active]="activeTab === 'south'"
        (click)="switchTab('south')"
      >
        <span class="tab-icon">‚¨áÔ∏è</span>
        <span class="tab-label" i18n="@@schedules.tab-south">To the South</span>
        <span class="tab-count">({{ schedulesByDirection.south.length }})</span>
      </button>
      
      <button 
        class="tab-button"
        [class.active]="activeTab === 'north'"
        (click)="switchTab('north')"
      >
        <span class="tab-icon">‚¨ÜÔ∏è</span>
        <span class="tab-label" i18n="@@schedules.tab-north">To the North</span>
        <span class="tab-count">({{ schedulesByDirection.north.length }})</span>
      </button>
      
      <button 
        class="tab-button"
        [class.active]="activeTab === 'islands'"
        (click)="switchTab('islands')"
      >
        <span class="tab-icon">üèùÔ∏è</span>
        <span class="tab-label" i18n="@@schedules.tab-islands">To the Islands</span>
        <span class="tab-count">({{ schedulesByDirection.islands.length }})</span>
      </button>
    </div>

    <!-- Contenu des onglets -->
    <div class="tabs-content">
      <!-- Onglet Sud -->
      <div *ngIf="activeTab === 'south'" class="tab-panel">
        <div class="schedules-list">
          <div 
            *ngFor="let scheduleDisplay of schedulesByDirection.south; trackBy: trackBySchedule" 
            class="schedule-card"
            (click)="toggleTripDetails(scheduleDisplay.schedule.trip_id)"
            [class.expanded]="isExpanded(scheduleDisplay.schedule.trip_id)"
          >
            <div class="schedule-header">
              <div class="schedule-title">
                <h4>{{ scheduleDisplay.line.name }}</h4>
                <div class="schedule-meta">
                  <span class="trip-id">{{ scheduleDisplay.schedule.trip_id }}</span>
                  <span class="duration">
                    ‚è±Ô∏è {{ getTripDuration(scheduleDisplay.schedule) }}
                  </span>
                </div>
              </div>
              <div class="schedule-description">
                {{ scheduleDisplay.schedule.description_fr }}
              </div>
            </div>

            <!-- D√©tails de la timeline - visible seulement si d√©velopp√© -->
            <div 
              class="schedule-timeline"
              [class.hidden]="!isExpanded(scheduleDisplay.schedule.trip_id)"
            >
              <div class="timeline-header">
                <span i18n="@@schedules.station">Station</span>
                <span i18n="@@schedules.schedule">Schedule</span>
              </div>
              
              <div class="timeline-content">
                <div 
                  *ngFor="let station of scheduleDisplay.stations; let i = index; trackBy: trackByStation"
                  class="timeline-stop"
                  [class.has-stop]="hasStopAtStation(scheduleDisplay.schedule, station.id)"
                  [class.no-stop]="!hasStopAtStation(scheduleDisplay.schedule, station.id)"
                >
                  <div class="stop-station">
                    <div class="stop-dot" [class.active]="hasStopAtStation(scheduleDisplay.schedule, station.id)"></div>
                    <div class="station-info">
                      <span class="station-name">{{ station.name_fr }}</span>
                      <span class="station-island">
                        {{ utilsService.getIslandIcon(station.island_fr) }} {{ station.island_fr }}
                      </span>
                    </div>
                  </div>
                  
                  <div class="stop-time">
                    <span 
                      class="time" 
                      [class.no-stop-time]="!hasStopAtStation(scheduleDisplay.schedule, station.id)"
                    >
                      {{ hasStopAtStation(scheduleDisplay.schedule, station.id) 
                         ? utilsService.formatTime(getStopTime(scheduleDisplay.schedule, station.id))
                         : '---' }}
                    </span>
                  </div>
                  
                  <div 
                    *ngIf="i < scheduleDisplay.stations.length - 1" 
                    class="timeline-connector"
                  ></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Message si aucun r√©sultat pour Sud -->
          <div *ngIf="schedulesByDirection.south.length === 0" class="no-results">
            <div class="no-results-icon">‚¨áÔ∏è</div>
            <h3 i18n="@@schedules.no-south-title">No schedule to the South</h3>
            <p i18n="@@schedules.no-south-message">No train goes to the South.</p>
          </div>
        </div>
      </div>

      <!-- Onglet Nord -->
      <div *ngIf="activeTab === 'north'" class="tab-panel">
        <div class="schedules-list">
          <div 
            *ngFor="let scheduleDisplay of schedulesByDirection.north; trackBy: trackBySchedule" 
            class="schedule-card"
            (click)="toggleTripDetails(scheduleDisplay.schedule.trip_id)"
            [class.expanded]="isExpanded(scheduleDisplay.schedule.trip_id)"
          >
            <div class="schedule-header">
              <div class="schedule-title">
                <h4>{{ scheduleDisplay.line.name }}</h4>
                <div class="schedule-meta">
                  <span class="trip-id">{{ scheduleDisplay.schedule.trip_id }}</span>
                  <span class="duration">
                    ‚è±Ô∏è {{ getTripDuration(scheduleDisplay.schedule) }}
                  </span>
                </div>
              </div>
              <div class="schedule-description">
                {{ scheduleDisplay.schedule.description_fr }}
              </div>
            </div>

            <!-- D√©tails de la timeline - visible seulement si d√©velopp√© -->
            <div 
              class="schedule-timeline"
              [class.hidden]="!isExpanded(scheduleDisplay.schedule.trip_id)"
            >
              <div class="timeline-header">
                <span i18n="@@schedules.station">Station</span>
                <span i18n="@@schedules.schedule">Schedule</span>
              </div>
              
              <div class="timeline-content">
                <div 
                  *ngFor="let station of scheduleDisplay.stations; let i = index; trackBy: trackByStation"
                  class="timeline-stop"
                  [class.has-stop]="hasStopAtStation(scheduleDisplay.schedule, station.id)"
                  [class.no-stop]="!hasStopAtStation(scheduleDisplay.schedule, station.id)"
                >
                  <div class="stop-station">
                    <div class="stop-dot" [class.active]="hasStopAtStation(scheduleDisplay.schedule, station.id)"></div>
                    <div class="station-info">
                      <span class="station-name">{{ station.name_fr }}</span>
                      <span class="station-island">
                        {{ utilsService.getIslandIcon(station.island_fr) }} {{ station.island_fr }}
                      </span>
                    </div>
                  </div>
                  
                  <div class="stop-time">
                    <span 
                      class="time" 
                      [class.no-stop-time]="!hasStopAtStation(scheduleDisplay.schedule, station.id)"
                    >
                      {{ hasStopAtStation(scheduleDisplay.schedule, station.id) 
                         ? utilsService.formatTime(getStopTime(scheduleDisplay.schedule, station.id))
                         : '---' }}
                    </span>
                  </div>
                  
                  <div 
                    *ngIf="i < scheduleDisplay.stations.length - 1" 
                    class="timeline-connector"
                  ></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Message si aucun r√©sultat pour Nord -->
          <div *ngIf="schedulesByDirection.north.length === 0" class="no-results">
            <div class="no-results-icon">‚¨ÜÔ∏è</div>
            <h3 i18n="@@schedules.no-north-title">No schedule to the North</h3>
            <p i18n="@@schedules.no-north-message">No train goes to the North.</p>
          </div>
        </div>
      </div>

      <!-- Onglet √éles -->
      <div *ngIf="activeTab === 'islands'" class="tab-panel">
        <div class="schedules-list">
          <div 
            *ngFor="let scheduleDisplay of schedulesByDirection.islands; trackBy: trackBySchedule" 
            class="schedule-card"
            (click)="toggleTripDetails(scheduleDisplay.schedule.trip_id)"
            [class.expanded]="isExpanded(scheduleDisplay.schedule.trip_id)"
          >
            <div class="schedule-header">
              <div class="schedule-title">
                <h4>{{ scheduleDisplay.line.name }}</h4>
                <div class="schedule-meta">
                  <span class="trip-id">{{ scheduleDisplay.schedule.trip_id }}</span>
                  <span class="duration">
                    ‚è±Ô∏è {{ getTripDuration(scheduleDisplay.schedule) }}
                  </span>
                </div>
              </div>
              <div class="schedule-description">
                {{ scheduleDisplay.schedule.description_fr }}
              </div>
            </div>

            <!-- D√©tails de la timeline - visible seulement si d√©velopp√© -->
            <div 
              class="schedule-timeline"
              [class.hidden]="!isExpanded(scheduleDisplay.schedule.trip_id)"
            >
              <div class="timeline-header">
                <span i18n="@@schedules.station">Station</span>
                <span i18n="@@schedules.schedule">Schedule</span>
              </div>
              
              <div class="timeline-content">
                <div 
                  *ngFor="let station of scheduleDisplay.stations; let i = index; trackBy: trackByStation"
                  class="timeline-stop"
                  [class.has-stop]="hasStopAtStation(scheduleDisplay.schedule, station.id)"
                  [class.no-stop]="!hasStopAtStation(scheduleDisplay.schedule, station.id)"
                >
                  <div class="stop-station">
                    <div class="stop-dot" [class.active]="hasStopAtStation(scheduleDisplay.schedule, station.id)"></div>
                    <div class="station-info">
                      <span class="station-name">{{ station.name_fr }}</span>
                      <span class="station-island">
                        {{ utilsService.getIslandIcon(station.island_fr) }} {{ station.island_fr }}
                      </span>
                    </div>
                  </div>
                  
                  <div class="stop-time">
                    <span 
                      class="time" 
                      [class.no-stop-time]="!hasStopAtStation(scheduleDisplay.schedule, station.id)"
                    >
                      {{ hasStopAtStation(scheduleDisplay.schedule, station.id) 
                         ? utilsService.formatTime(getStopTime(scheduleDisplay.schedule, station.id))
                         : '---' }}
                    </span>
                  </div>
                  
                  <div 
                    *ngIf="i < scheduleDisplay.stations.length - 1" 
                    class="timeline-connector"
                  ></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Message si aucun r√©sultat pour √éles -->
          <div *ngIf="schedulesByDirection.islands.length === 0" class="no-results">
            <div class="no-results-icon">üèùÔ∏è</div>
            <h3 i18n="@@schedules.no-islands-title">No schedule to the Islands</h3>
            <p i18n="@@schedules.no-islands-message">No train goes to the islands.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
