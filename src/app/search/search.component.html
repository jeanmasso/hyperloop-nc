<div class="search-container">
  <div class="search-header">
    <h1 class="display-4">ğŸ” Recherche de Trajets</h1>
    <p class="lead">Trouvez le trajet parfait pour votre voyage en Nouvelle-CalÃ©donie</p>
  </div>

  <!-- Formulaire de recherche -->
  <div class="search-form-section">
    <div class="search-form-card">
      <div class="form-header">
        <h3>ğŸ¯ Vos critÃ¨res de recherche</h3>
        <p class="form-description">SÃ©lectionnez votre trajet et vos prÃ©fÃ©rences</p>
      </div>

      <form class="search-form" (ngSubmit)="performSearch()">
        <!-- SÃ©lection des stations -->
        <div class="stations-row">
          <div class="station-group">
            <label class="form-label">
              <span class="label-icon">ğŸš‰</span>
              Station de dÃ©part
            </label>
            <select 
              class="form-select"
              [(ngModel)]="searchCriteria.originId"
              name="origin"
              required
            >
              <option value="">Choisir une station de dÃ©part</option>
              <option 
                *ngFor="let station of stations$ | async" 
                [value]="station.id"
              >
                {{ station.name_fr }} ({{ station.island_fr }})
              </option>
            </select>
          </div>

          <div class="swap-button-container">
            <button 
              type="button" 
              class="swap-button btn"
              (click)="swapStations()"
              [disabled]="!searchCriteria.originId && !searchCriteria.destinationId"
              title="Ã‰changer les stations"
            >
              ğŸ”„
            </button>
          </div>

          <div class="station-group">
            <label class="form-label">
              <span class="label-icon">ğŸ</span>
              Station d'arrivÃ©e
            </label>
            <select 
              class="form-select"
              [(ngModel)]="searchCriteria.destinationId"
              name="destination"
              required
            >
              <option value="">Choisir une station d'arrivÃ©e</option>
              <option 
                *ngFor="let station of stations$ | async" 
                [value]="station.id"
                [disabled]="station.id === searchCriteria.originId"
              >
                {{ station.name_fr }} ({{ station.island_fr }})
              </option>
            </select>
          </div>
        </div>

        <!-- Autres critÃ¨res -->
        <div class="criteria-row">
          <div class="form-group">
            <label class="form-label">
              <span class="label-icon">ğŸ“…</span>
              Date de dÃ©part
            </label>
            <input 
              type="date" 
              class="form-control"
              [(ngModel)]="searchCriteria.departureDate"
              name="departureDate"
              [min]="searchCriteria.departureDate | date:'yyyy-MM-dd'"
            >
          </div>

          <div class="form-group">
            <label class="form-label">
              <span class="label-icon">ğŸ­</span>
              Classe de service
            </label>
            <select 
              class="form-select"
              [(ngModel)]="searchCriteria.serviceClass"
              name="serviceClass"
            >
              <option 
                *ngFor="let option of serviceClassOptions" 
                [value]="option.value"
              >
                {{ option.label }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">
              <span class="label-icon">ğŸ•</span>
              PrÃ©fÃ©rence horaire
            </label>
            <select 
              class="form-select"
              [(ngModel)]="searchCriteria.timePreference"
              name="timePreference"
            >
              <option 
                *ngFor="let option of timePreferenceOptions" 
                [value]="option.value"
              >
                {{ option.icon }} {{ option.label }}
              </option>
            </select>
          </div>
        </div>

        <!-- Boutons d'action -->
        <div class="form-actions">
          <button 
            type="button"
            class="btn btn-secondary"
            (click)="resetSearch()"
          >
            <span class="btn-icon">ğŸ”„</span>
            RÃ©initialiser
          </button>
          
          <button 
            type="submit"
            class="btn btn-primary"
            [disabled]="!isSearchValid() || loading"
          >
            <span class="btn-icon" *ngIf="!loading">ğŸ”</span>
            <span class="btn-icon loading-spinner" *ngIf="loading">â³</span>
            {{ loading ? 'Recherche...' : 'Rechercher' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- RÃ©sultats de recherche -->
  <div *ngIf="searchPerformed" class="search-results-section">
    <div class="results-header">
      <h3>ğŸ“‹ RÃ©sultats de recherche</h3>
      <div class="results-info">
        <span class="results-count">{{ searchResults.length }} trajet(s) trouvÃ©(s)</span>
        <div class="selected-criteria">
          <span class="criteria-badge" *ngIf="searchCriteria.serviceClass">
            {{ getServiceClassIcon(searchCriteria.serviceClass) }}
            {{ getServiceClassLabel(searchCriteria.serviceClass) }}
          </span>
        </div>
      </div>
    </div>

    <!-- Liste des rÃ©sultats -->
    <div class="results-list" *ngIf="searchResults.length > 0">
      <div 
        *ngFor="let result of searchResults; trackBy: trackByResult" 
        class="result-card"
      >
        <div class="result-header">
          <div class="route-info">
            <div class="stations-route">
              <div class="station origin">
                <span class="station-icon">ğŸš‰</span>
                <div class="station-details">
                  <span class="station-name">{{ result.origin.name_fr }}</span>
                  <span class="station-island">{{ result.origin.island_fr }}</span>
                </div>
              </div>
              
              <div class="route-arrow">
                <span class="arrow">â†’</span>
                <span class="duration" *ngIf="result.duration">{{ result.duration }}</span>
              </div>
              
              <div class="station destination">
                <span class="station-icon">ğŸ</span>
                <div class="station-details">
                  <span class="station-name">{{ result.destination.name_fr }}</span>
                  <span class="station-island">{{ result.destination.island_fr }}</span>
                </div>
              </div>
            </div>
          </div>

          <div class="price-info">
            <div class="price-amount">
              <span class="price-value">
                {{ formatPrice(result.price[searchCriteria.serviceClass!]) }}
              </span>
              <span class="price-class">{{ getServiceClassLabel(searchCriteria.serviceClass!) }}</span>
            </div>
          </div>
        </div>

        <div class="result-details">
          <div class="schedule-info">
            <span class="schedule-icon">ğŸ•</span>
            <span class="schedule-text">{{ result.schedule.description_fr }}</span>
          </div>
          
          <div class="additional-info" *ngIf="result.distance">
            <span class="distance">
              <span class="distance-icon">ğŸ“</span>
              {{ result.distance }} km
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Message si aucun rÃ©sultat -->
    <div class="no-results" *ngIf="searchResults.length === 0 && !loading">
      <div class="no-results-icon">ğŸ”</div>
      <h4>Aucun trajet trouvÃ©</h4>
      <p>Aucun trajet ne correspond Ã  vos critÃ¨res de recherche.</p>
      <div class="suggestions">
        <p>Suggestions :</p>
        <ul>
          <li>VÃ©rifiez les stations sÃ©lectionnÃ©es</li>
          <li>Essayez une autre classe de service</li>
          <li>Modifiez vos prÃ©fÃ©rences horaires</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Message de premiÃ¨re visite -->
  <div *ngIf="!searchPerformed && !loading" class="welcome-message">
    <div class="welcome-icon">ğŸ¯</div>
    <h3>PrÃªt Ã  voyager ?</h3>
    <p>SÃ©lectionnez vos stations de dÃ©part et d'arrivÃ©e pour commencer votre recherche de trajet.</p>
    <div class="features">
      <div class="feature">
        <span class="feature-icon">âš¡</span>
        <span class="feature-text">Recherche rapide</span>
      </div>
      <div class="feature">
        <span class="feature-icon">ğŸ­</span>
        <span class="feature-text">Toutes les classes</span>
      </div>
      <div class="feature">
        <span class="feature-icon">ğŸ•</span>
        <span class="feature-text">Horaires flexibles</span>
      </div>
    </div>
  </div>
</div>
