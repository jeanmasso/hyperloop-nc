<div class="search-container">
  <div class="search-header">
    <h1 class="display-4" i18n="search page title">🔍 Trip Search</h1>
    <p class="lead" i18n="search page description">Find the perfect trip for your journey in New Caledonia</p>
  </div>

  <!-- Formulaire de recherche -->
  <div class="search-form-section">
    <div class="search-form-card">
      <div class="form-header">
        <h3 i18n="search criteria title">🎯 Your search criteria</h3>
        <p class="form-description" i18n="search criteria description">Select your trip and preferences</p>
      </div>

      <form class="search-form" (ngSubmit)="performSearch()">
        <!-- Sélection des stations -->
        <div class="stations-row">
          <div class="station-group">
            <label class="form-label">
              <span class="label-icon">🚉</span>
              <span i18n="@@search.departure-station">Departure station</span>
            </label>
            <select 
              class="form-select"
              [(ngModel)]="searchCriteria.originId"
              name="origin"
              required
            >
              <option value="" i18n="@@search.choose-departure">Choose a departure station</option>
              <option 
                *ngFor="let station of stations$ | async" 
                [value]="station.id"
              >
                {{ station.name_fr }} ({{ station.island_fr }})
              </option>
            </select>
          </div>

          <div class="swap-button-container">
            <button 
              type="button" 
              class="swap-button btn"
              (click)="swapStations()"
              [disabled]="!searchCriteria.originId && !searchCriteria.destinationId"
              i18n-title="@@search.swap-stations"
              title="Swap stations"
            >
              🔄
            </button>
          </div>

          <div class="station-group">
            <label class="form-label">
              <span class="label-icon">🏁</span>
              <span i18n="@@search.arrival-station">Arrival station</span>
            </label>
            <select 
              class="form-select"
              [(ngModel)]="searchCriteria.destinationId"
              name="destination"
              required
            >
              <option value="" i18n="@@search.choose-arrival">Choose an arrival station</option>
              <option 
                *ngFor="let station of stations$ | async" 
                [value]="station.id"
                [disabled]="station.id === searchCriteria.originId"
              >
                {{ station.name_fr }} ({{ station.island_fr }})
              </option>
            </select>
          </div>
        </div>

        <!-- Autres critères -->
        <div class="criteria-row">
          <div class="form-group">
            <label class="form-label">
              <span class="label-icon">📅</span>
              <span i18n="@@search.departure-date">Departure date</span>
            </label>
            <input 
              type="date" 
              class="form-control"
              [(ngModel)]="searchCriteria.departureDate"
              name="departureDate"
              [min]="searchCriteria.departureDate | date:'yyyy-MM-dd'"
            >
          </div>

          <div class="form-group">
            <label class="form-label">
              <span class="label-icon">🎭</span>
              <span i18n="@@search.service-class">Service class</span>
            </label>
            <select 
              class="form-select"
              [(ngModel)]="searchCriteria.serviceClass"
              name="serviceClass"
            >
              <option 
                *ngFor="let option of serviceClassOptions" 
                [value]="option.value"
              >
                {{ option.label }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">
              <span class="label-icon">🕐</span>
              <span i18n="@@search.time-preference">Time preference</span>
            </label>
            <select 
              class="form-select"
              [(ngModel)]="searchCriteria.timePreference"
              name="timePreference"
            >
              <option 
                *ngFor="let option of timePreferenceOptions" 
                [value]="option.value"
              >
                {{ option.icon }} {{ option.label }}
              </option>
            </select>
          </div>
        </div>

        <!-- Boutons d'action -->
        <div class="form-actions">
          <button 
            type="button"
            class="btn btn-secondary"
            (click)="resetSearch()"
          >
            <span class="btn-icon">🔄</span>
            <span i18n="@@search.reset">Reset</span>
          </button>
          
          <button 
            type="submit"
            class="btn btn-primary"
            [disabled]="!isSearchValid() || loading"
          >
            <span class="btn-icon" *ngIf="!loading">🔍</span>
            <span class="btn-icon loading-spinner" *ngIf="loading">⏳</span>
            <span *ngIf="loading" i18n="@@search.searching">Searching...</span>
            <span *ngIf="!loading" i18n="@@search.search">Search</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Résultats de recherche -->
  <div *ngIf="searchPerformed" class="search-results-section">
    <div class="results-header">
      <h3 i18n="@@search.results-title">📋 Search results</h3>
      <div class="results-info">
        <span class="results-count" i18n="@@search.results-count">{{ searchResults.length }} trip(s) found</span>
        <div class="selected-criteria">
          <span class="criteria-badge" *ngIf="searchCriteria.serviceClass">
            {{ getServiceClassIcon(searchCriteria.serviceClass) }}
            {{ getServiceClassLabel(searchCriteria.serviceClass) }}
          </span>
        </div>
      </div>
    </div>

    <!-- Liste des résultats -->
    <div class="results-list" *ngIf="searchResults.length > 0">
      <div 
        *ngFor="let result of searchResults; trackBy: trackByResult" 
        class="result-card"
      >
        <div class="result-header">
          <div class="route-info">
            <div class="stations-route">
              <div class="station origin">
                <span class="station-icon">🚉</span>
                <div class="station-details">
                  <span class="station-name">{{ result.origin.name_fr }}</span>
                  <span class="station-island">{{ result.origin.island_fr }}</span>
                </div>
              </div>
              
              <div class="route-arrow">
                <span class="arrow">→</span>
                <span class="duration" *ngIf="result.duration">{{ result.duration }}</span>
              </div>
              
              <div class="station destination">
                <span class="station-icon">🏁</span>
                <div class="station-details">
                  <span class="station-name">{{ result.destination.name_fr }}</span>
                  <span class="station-island">{{ result.destination.island_fr }}</span>
                </div>
              </div>
            </div>
          </div>

          <div class="price-info">
            <div class="price-amount">
              <span class="price-value">
                {{ formatPrice(result.price[searchCriteria.serviceClass!]) }}
              </span>
              <span class="price-class">{{ getServiceClassLabel(searchCriteria.serviceClass!) }}</span>
            </div>
          </div>
        </div>

        <div class="result-details">
          <div class="schedule-info">
            <span class="schedule-icon">🕐</span>
            <span class="schedule-text">{{ result.schedule.description_fr }}</span>
          </div>
          
          <div class="additional-info" *ngIf="result.distance">
            <span class="distance">
              <span class="distance-icon">📏</span>
              <span>{{ result.distance }} km</span>
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Message si aucun résultat -->
    <div class="no-results" *ngIf="searchResults.length === 0 && !loading">
      <div class="no-results-icon">🔍</div>
      <h4 i18n="@@search.no-results-title">No trip found</h4>
      <p i18n="@@search.no-results-message">No trip matches your search criteria.</p>
      <div class="suggestions">
        <p i18n="@@search.suggestions-title">Suggestions:</p>
        <ul>
          <li i18n="@@search.suggestion-1">Check the selected stations</li>
          <li i18n="@@search.suggestion-2">Try another service class</li>
          <li i18n="@@search.suggestion-3">Change your time preferences</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Message de première visite -->
  <div *ngIf="!searchPerformed && !loading" class="welcome-message">
    <div class="welcome-icon">🎯</div>
    <h3 i18n="@@search.welcome-title">Ready to travel?</h3>
    <p i18n="@@search.welcome-message">Select your departure and arrival stations to start your trip search.</p>
    <div class="features">
      <div class="feature">
        <span class="feature-icon">⚡</span>
        <span class="feature-text" i18n="@@search.feature-fast">Fast search</span>
      </div>
      <div class="feature">
        <span class="feature-icon">🎭</span>
        <span class="feature-text" i18n="@@search.feature-classes">All classes</span>
      </div>
      <div class="feature">
        <span class="feature-icon">🕐</span>
        <span class="feature-text" i18n="@@search.feature-flexible">Flexible schedules</span>
      </div>
    </div>
  </div>
</div>
