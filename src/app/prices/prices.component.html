<div class="prices-container">
  <div class="prices-header">
    <h1 class="display-4" i18n="prices page title">💰 Transport Fares</h1>
    <p class="lead" i18n="prices page description">Check all transport fares between stations in New Caledonia</p>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="d-flex flex-column align-items-center">
      <div class="loading-spinner">💰</div>
      <p class="mt-3" i18n="@@prices.loading">Loading fares...</p>
    </div>
  </div>

  <!-- Présentation des classes de service -->
  <div *ngIf="!loading" class="service-classes-section">
    <div class="section-header">
      <h2 i18n="@@prices.service-classes-title">🎭 Service Classes</h2>
      <p class="section-description" i18n="@@prices.service-classes-description">Discover our different transport classes adapted to all budgets</p>
    </div>
    
    <div class="classes-grid">
      <!-- Première Classe -->
      <div class="class-card premium" [class.active]="activeTab === 'first_class'" (click)="switchTab('first_class')">
        <div class="class-image-container">
          <img src="images/first-class.png" i18n-alt="@@prices.first-class-alt" alt="First Class" class="class-image" />
        </div>
        <div class="class-header">
          <h3 class="class-title" i18n="@@prices.first-class">First Class</h3>
          <span class="class-badge premium-badge" i18n="@@prices.premium-badge">Premium</span>
        </div>
        <div class="class-features">
          <ul class="features-list">
            <li><span class="feature-icon">🛋️</span> <span i18n="@@prices.premium-seats">Premium leather seats</span></li>
            <li><span class="feature-icon">🍽️</span> <span i18n="@@prices.catering-service">Catering service</span></li>
            <li><span class="feature-icon">📱</span> <span i18n="@@prices.free-wifi">Free Wi-Fi</span></li>
            <li><span class="feature-icon">🎧</span> <span i18n="@@prices.personal-entertainment">Personal entertainment</span></li>
            <li><span class="feature-icon">🧳</span> <span i18n="@@prices.priority-luggage">Priority luggage</span></li>
          </ul>
        </div>
        <div class="class-pricing">
          <span class="price-label" i18n="@@prices.starting-from">Starting from</span>
          <span class="price-range">1 200 - 2 500 XPF</span>
        </div>
      </div>

      <!-- Deuxième Classe -->
      <div class="class-card standard" [class.active]="activeTab === 'second_class'" (click)="switchTab('second_class')">
        <div class="class-image-container">
          <img src="images/second-class.png" i18n-alt="@@prices.second-class-alt" alt="Second Class" class="class-image" />
        </div>
        <div class="class-header">
          <h3 class="class-title" i18n="@@prices.second-class">Second Class</h3>
          <span class="class-badge standard-badge" i18n="@@prices.recommended-badge">Recommended</span>
        </div>
        <div class="class-features">
          <ul class="features-list">
            <li><span class="feature-icon">💺</span> <span i18n="@@prices.comfortable-seats">Comfortable seats</span></li>
            <li><span class="feature-icon">☕</span> <span i18n="@@prices.snacks-available">Snacks available</span></li>
            <li><span class="feature-icon">🌡️</span> <span i18n="@@prices.air-conditioning">Air conditioning</span></li>
            <li><span class="feature-icon">🔌</span> <span i18n="@@prices.power-outlets">Power outlets</span></li>
            <li><span class="feature-icon">📍</span> <span i18n="@@prices.trip-information">Trip information</span></li>
          </ul>
        </div>
        <div class="class-pricing">
          <span class="price-label" i18n="@@prices.starting-from">Starting from</span>
          <span class="price-range">700 - 1 800 XPF</span>
        </div>
      </div>

      <!-- Troisième Classe -->
      <div class="class-card economy" [class.active]="activeTab === 'third_class'" (click)="switchTab('third_class')">
        <div class="class-image-container">
          <img src="images/third-class.png" i18n-alt="@@prices.third-class-alt" alt="Third Class" class="class-image" />
        </div>
        <div class="class-header">
          <h3 class="class-title" i18n="@@prices.third-class">Third Class</h3>
          <span class="class-badge economy-badge" i18n="@@prices.economy-badge">Economy</span>
        </div>
        <div class="class-features">
          <ul class="features-list">
            <li><span class="feature-icon">🪑</span> <span i18n="@@prices.standard-seats">Standard seats</span></li>
            <li><span class="feature-icon">🚿</span> <span i18n="@@prices.onboard-toilets">Onboard toilets</span></li>
            <li><span class="feature-icon">📢</span> <span i18n="@@prices.voice-announcements">Voice announcements</span></li>
            <li><span class="feature-icon">🆘</span> <span i18n="@@prices.emergency-service">Emergency service</span></li>
            <li><span class="feature-icon">💼</span> <span i18n="@@prices.luggage-lockers">Luggage lockers</span></li>
          </ul>
        </div>
        <div class="class-pricing">
          <span class="price-label" i18n="@@prices.starting-from">Starting from</span>
          <span class="price-range">500 - 1 200 XPF</span>
        </div>
      </div>
    </div>

    <div class="selection-indicator">
      <p class="selected-class-info">
        <span class="current-icon">{{ getServiceClassIcon(activeTab) }}</span>
        <span i18n="@@prices.fares-displayed-for">Fares displayed for:</span> 
        <strong>
          <span *ngIf="activeTab === 'first_class'" i18n="prices service first-class">First Class</span>
          <span *ngIf="activeTab === 'second_class'" i18n="prices service second-class">Second Class</span>
          <span *ngIf="activeTab === 'third_class'" i18n="prices service third-class">Third Class</span>
        </strong>
      </p>
    </div>
  </div>

  <!-- Filtrage par localisation -->
  <div *ngIf="!loading" class="location-filter-section">
    <div class="section-header">
      <h3 i18n="@@prices.filter-by-location">📍 Filter by geographical area</h3>
      <p class="section-description" i18n="@@prices.select-location-description">Select a geographical area of New Caledonia</p>
    </div>
    
    <div class="location-tabs-container">
      <div class="location-tabs-header d-flex justify-content-center flex-wrap">
        <button 
          class="location-tab-button btn"
          [class.active]="activeLocationTab === 'grande-terre'"
          (click)="switchLocationTab('grande-terre')"
        >
          <span class="tab-icon">{{ getLocationTabIcon('grande-terre') }}</span>
          <span class="tab-label" i18n="prices tab main-island">Main Island</span>
          <span class="tab-count">({{ getLocationTabCount('grande-terre') }})</span>
        </button>
        
        <button 
          class="location-tab-button btn"
          [class.active]="activeLocationTab === 'loyaute'"
          (click)="switchLocationTab('loyaute')"
        >
          <span class="tab-icon">{{ getLocationTabIcon('loyaute') }}</span>
          <span class="tab-label" i18n="prices tab loyalty-islands">Loyalty Islands</span>
          <span class="tab-count">({{ getLocationTabCount('loyaute') }})</span>
        </button>
        
        <button 
          class="location-tab-button btn"
          [class.active]="activeLocationTab === 'ile-des-pins'"
          (click)="switchLocationTab('ile-des-pins')"
        >
          <span class="tab-icon">{{ getLocationTabIcon('ile-des-pins') }}</span>
          <span class="tab-label" i18n="prices tab pine-island">Pine Island</span>
          <span class="tab-count">({{ getLocationTabCount('ile-des-pins') }})</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Liste des tarifs -->
  <div *ngIf="!loading" class="prices-content">
    <div class="prices-list">
      <div 
        *ngFor="let priceDisplay of getFilteredPrices(); trackBy: trackByPrice" 
        class="price-card"
        (click)="togglePriceDetails(getPriceId(priceDisplay))"
        [class.expanded]="isExpanded(getPriceId(priceDisplay))"
      >
        <div class="price-header">
          <div class="route-info">
            <div class="stations">
              <div class="origin-station">
                <span class="station-icon">🚉</span>
                <span class="station-name">{{ priceDisplay.originStation.name_fr }}</span>
              </div>
              <div class="route-arrow">→</div>
              <div class="destination-station">
                <span class="station-icon">🚉</span>
                <span class="station-name">{{ priceDisplay.destinationStation.name_fr }}</span>
              </div>
            </div>
            <div class="route-details" *ngIf="priceDisplay.distance">
              <span class="distance">{{ priceDisplay.distance }} km</span>
            </div>
          </div>
          <div class="price-info">
            <div class="current-price">
              <span class="price-amount">{{ formatPrice(getPriceForClass(priceDisplay.price.prices, activeTab)) }}</span>
              <span class="price-class">
                <span *ngIf="activeTab === 'first_class'" i18n="prices service first-class">First Class</span>
                <span *ngIf="activeTab === 'second_class'" i18n="prices service second-class">Second Class</span>
                <span *ngIf="activeTab === 'third_class'" i18n="prices service third-class">Third Class</span>
              </span>
            </div>
            <div class="price-per-km" *ngIf="priceDisplay.pricePerKm && activeTab === 'second_class'">
              <span class="rate">{{ formatPrice(priceDisplay.pricePerKm) }}/km</span>
            </div>
          </div>
        </div>

        <!-- Détails du tarif (expandable) -->
        <div *ngIf="isExpanded(getPriceId(priceDisplay))" class="price-details">
          <div class="details-section">
            <h5 i18n="@@prices.fares-by-class">💰 Fares by class:</h5>
            <div class="prices-breakdown">
              <div class="price-class-item">
                <span class="class-icon">✨</span>
                <span class="class-name" i18n="@@prices.first-class">First Class</span>
                <span class="class-price">{{ formatPrice(priceDisplay.price.prices.first_class) }}</span>
              </div>
              <div class="price-class-item">
                <span class="class-icon">🚂</span>
                <span class="class-name" i18n="@@prices.second-class">Second Class</span>
                <span class="class-price">{{ formatPrice(priceDisplay.price.prices.second_class) }}</span>
              </div>
              <div class="price-class-item">
                <span class="class-icon">🎫</span>
                <span class="class-name" i18n="@@prices.third-class">Third Class</span>
                <span class="class-price">{{ formatPrice(priceDisplay.price.prices.third_class) }}</span>
              </div>
            </div>
          </div>
          
          <div class="details-section" *ngIf="priceDisplay.distance">
            <h5 i18n="@@prices.trip-information">📏 Trip information:</h5>
            <div class="route-stats">
              <div class="stat-item">
                <span class="stat-label" i18n="@@prices.distance">Distance:</span>
                <span class="stat-value">{{ priceDisplay.distance }} km</span>
              </div>
              <div class="stat-item" *ngIf="priceDisplay.pricePerKm">
                <span class="stat-label" i18n="@@prices.price-per-km">Price per km (2nd class):</span>
                <span class="stat-value">{{ formatPrice(priceDisplay.pricePerKm) }}</span>
              </div>
            </div>
          </div>

          <div class="details-section">
            <h5 i18n="@@prices.islands-served">🏝️ Islands served:</h5>
            <div class="islands-info">
              <span class="island-badge origin">{{ priceDisplay.originStation.island_fr }}</span>
              <span class="arrow">→</span>
              <span class="island-badge destination">{{ priceDisplay.destinationStation.island_fr }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Message si aucun tarif -->
    <div *ngIf="getFilteredPrices().length === 0" class="no-results">
      <div class="no-results-icon">💰</div>
      <h3 i18n="@@prices.no-fares-found">No fare found</h3>
      <p i18n="@@prices.no-fares-message">No fare is available for the area {{ getLocationTabLabel(activeLocationTab) }} in {{ getServiceClassLabel(activeTab) }}.</p>
    </div>
  </div>
</div>
